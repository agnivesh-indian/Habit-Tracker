<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            color: #1c1e21;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            background-color: #fff;
            padding: 10px 20px;
            border-bottom: 1px solid #dddfe2;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav h1 {
            margin: 0;
            font-size: 1.5rem;
            color: #1877f2;
        }
        nav a {
            color: #1877f2;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }
        .hidden { display: none; }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .habit-item, .stat-card, .correlation-card, .chart-placeholder {
            background-color: #fff;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .habit-item { cursor: pointer; transition: box-shadow 0.2s ease; }
        .habit-item:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        h2, h3 { color: #1c1e21; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card p {
            font-size: 1.75rem;
            font-weight: bold;
            color: #1877f2;
            margin: 4px 0 0 0;
        }
    </style>
</head>
<body>
    <nav>
        <h1>Habit Tracker</h1>
        <a id="home-link">Home</a>
    </nav>

    <main class="container">
        <div id="home-page">
            <h2>Your Habits</h2>
            <div id="habit-list" class="grid-container"></div>
        </div>
        <div id="habit-detail-page" class="hidden">
            <h2 id="detail-habit-name"></h2>
            <p id="detail-habit-category" style="margin-top:-15px; color:#606770;"></p>
            <h3>Descriptive Statistics</h3>
            <div class="stats-grid">
                <div class="stat-card"><h4>Completion Rate</h4><p id="stat-completion-rate"></p></div>
                <div class="stat-card"><h4>Consistency</h4><p id="stat-consistency"></p></div>
                <div class="stat-card"><h4>30-Day Trend</h4><p id="stat-trend"></p></div>
            </div>
            <h3>Correlation Insights</h3>
            <div id="correlation-insights" class="grid-container"></div>
            <h3>Visualizations</h3>
            <div class="visualization-grid" style="display:grid; grid-template-columns:1fr; gap:20px;">
                <div class="chart-placeholder">Yearly Consistency Heatmap (Placeholder)</div>
                <div class="chart-placeholder">Category Distribution Pie Chart (Placeholder)</div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA ---
            const allHabits = [
                {
                    id: 'h1', name: 'Work Out', category: 'Health', goalType: 'daily',
                    logs: Array.from({length: 30}, (_, i) => ({ date: `2025-11-${String(i+1).padStart(2,'0')}`, completed: Math.random() > 0.3 })),
                },
                {
                    id: 'h2', name: 'Sleep 8+ hours', category: 'Health', goalType: 'daily',
                    logs: Array.from({length: 30}, (_, i) => ({ date: `2025-11-${String(i+1).padStart(2,'0')}`, completed: Math.random() > 0.2 })),
                },
                {
                    id: 'h3', name: 'Read 20 Pages', category: 'Personal Growth', goalType: 'cumulative', goalAmount: 20,
                    logs: Array.from({length: 30}, (_, i) => ({ date: `2025-11-${String(i+1).padStart(2,'0')}`, value: Math.floor(Math.random() * 35) })),
                },
            ];

            // --- DOM ELEMENTS ---
            const homePage = document.getElementById('home-page');
            const habitDetailPage = document.getElementById('habit-detail-page');
            const habitListContainer = document.getElementById('habit-list');
            const homeLink = document.getElementById('home-link');

            // --- STATS ENGINE ---
            const calculateCompletionRate = (habit) => {
                if (!habit.logs || habit.logs.length === 0) return 0;
                if (habit.goalType === 'daily') {
                    const completedCount = habit.logs.filter(log => log.completed).length;
                    return (completedCount / habit.logs.length) * 100;
                }
                if (habit.goalType === 'cumulative') {
                    if (!habit.goalAmount) return 0;
                    const totalValue = habit.logs.reduce((sum, log) => sum + (log.value || 0), 0);
                    const avgProgress = (totalValue / (habit.logs.length * habit.goalAmount)) * 100;
                    return Math.min(avgProgress, 100);
                }
                return 0;
            };
            const calculateConsistency = (habit) => {
                if (!habit.logs || habit.logs.length < 2) return 0;
                let values;
                if (habit.goalType === 'daily') {
                    values = habit.logs.map(log => (log.completed ? 1 : 0));
                } else {
                    if (!habit.goalAmount) return 0;
                    values = habit.logs.map(log => (log.value || 0) / habit.goalAmount);
                }
                const avg = values.reduce((s, v) => s + v, 0) / values.length;
                const squareDiffs = values.map(v => (v - avg) ** 2);
                const avgSquareDiff = squareDiffs.reduce((s, v) => s + v, 0) / squareDiffs.length;
                return Math.sqrt(avgSquareDiff);
            };
            const calculateTrendVelocity = (habit) => {
                const recentLogs = habit.logs.slice(-30);
                if (recentLogs.length < 2) return 0;
                const midpoint = Math.floor(recentLogs.length / 2);
                const firstHalf = recentLogs.slice(0, midpoint);
                const secondHalf = recentLogs.slice(midpoint);
                if (firstHalf.length === 0 || secondHalf.length === 0) return 0;
                const firstHalfRate = calculateCompletionRate({ ...habit, logs: firstHalf });
                const secondHalfRate = calculateCompletionRate({ ...habit, logs: secondHalf });
                if (firstHalfRate === 0) return secondHalfRate > 0 ? 100 : 0;
                return ((secondHalfRate - firstHalfRate) / firstHalfRate) * 100;
            };
            const analyzeCorrelations = (primaryHabit, allHabits) => {
                const correlations = [];
                const otherHabits = allHabits.filter(h => h.id !== primaryHabit.id);
                const primaryHabitLogMap = new Map(primaryHabit.logs.map(log => [log.date, log]));
                for (const otherHabit of otherHabits) {
                    const commonDates = primaryHabit.logs.map(log => log.date).filter(date => otherHabit.logs.some(otherLog => otherLog.date === date));
                    if (commonDates.length < 5) continue;
                    const primarySuccessDays = new Set(commonDates.filter(date => {
                        const log = primaryHabitLogMap.get(date);
                        return primaryHabit.goalType === 'daily' ? log.completed : (log.value || 0) >= (primaryHabit.goalAmount || Infinity);
                    }));
                    if (primarySuccessDays.size === 0) continue;
                    const otherHabitOnPrimarySuccessLogs = otherHabit.logs.filter(log => primarySuccessDays.has(log.date));
                    if (otherHabitOnPrimarySuccessLogs.length === 0) continue;
                    const correlationRate = calculateCompletionRate({ ...otherHabit, logs: otherHabitOnPrimarySuccessLogs });
                    const baseRate = calculateCompletionRate(otherHabit);
                    if (baseRate > 0) {
                        const likelihoodIncrease = ((correlationRate - baseRate) / baseRate) * 100;
                        if (likelihoodIncrease > 10) {
                            correlations.push({ habitName: otherHabit.name, likelihoodIncrease: Math.round(likelihoodIncrease) });
                        }
                    }
                }
                return correlations;
            };

            // --- APP LOGIC ---
            const showHomePage = () => {
                habitDetailPage.classList.add('hidden');
                homePage.classList.remove('hidden');
            };
            const showHabitDetail = (habitId) => {
                const habit = allHabits.find(h => h.id === habitId);
                if (!habit) return;
                document.getElementById('detail-habit-name').textContent = habit.name;
                document.getElementById('detail-habit-category').textContent = habit.category;
                document.getElementById('stat-completion-rate').textContent = `${calculateCompletionRate(habit).toFixed(1)}%`;
                document.getElementById('stat-consistency').textContent = calculateConsistency(habit).toFixed(2);
                document.getElementById('stat-trend').textContent = `${calculateTrendVelocity(habit).toFixed(1)}%`;
                
                const correlationInsights = document.getElementById('correlation-insights');
                correlationInsights.innerHTML = '';
                const correlations = analyzeCorrelations(habit, allHabits);
                if (correlations.length > 0) {
                    correlations.forEach(corr => {
                        const card = document.createElement('div');
                        card.className = 'correlation-card';
                        card.innerHTML = `<p>You are <strong>${corr.likelihoodIncrease}%</strong> more likely to <strong>${corr.habitName}</strong> on days you complete this.</p>`;
                        correlationInsights.appendChild(card);
                    });
                } else {
                    correlationInsights.innerHTML = '<p>No significant correlations found.</p>';
                }

                homePage.classList.add('hidden');
                habitDetailPage.classList.remove('hidden');
            };

            const renderHabitList = () => {
                habitListContainer.innerHTML = '';
                allHabits.forEach(habit => {
                    const habitItem = document.createElement('div');
                    habitItem.className = 'habit-item';
                    habitItem.innerHTML = `<h3>${habit.name}</h3><p>${habit.category}</p>`;
                    habitItem.addEventListener('click', () => showHabitDetail(habit.id));
                    habitListContainer.appendChild(habitItem);
                });
            };

            homeLink.addEventListener('click', showHomePage);
            
            // Initial render
            renderHabitList();
            showHomePage();
        });
    </script>
</body>
</html>
